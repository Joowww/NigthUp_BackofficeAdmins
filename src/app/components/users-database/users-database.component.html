<div class="page-container">
  <!-- PAGE HEADER -->
  <header class="page-header">
    <div>
      <h1 class="page-title">User Database</h1>
      <p class="page-subtitle">Manage all platform users</p>
    </div>
  </header>

  <!-- SEARCH AND FILTERS SECTION -->
  <section class="search-filters">
    <div class="search-container">
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input
        type="text"
        placeholder="Search users by name or email..."
        [(ngModel)]="searchTerm"
        class="search-input"
      />
    </div>
    <button class="filter-button">
      <svg class="filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
      </svg>
      Filters
    </button>
    <button class="export-button">
      <svg class="export-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
      </svg>
      Export
    </button>
  </section>

  <!-- STATISTICS CARDS -->
  <section class="stats-cards">
    <article class="stat-card">
      <div class="stat-label">Total Users</div>
      <div class="stat-value">2,547</div>
    </article>
    <article class="stat-card">
      <div class="stat-label">Active</div>
      <div class="stat-value active">2,103</div>
    </article>
    <article class="stat-card">
      <div class="stat-label">Inactive</div>
      <div class="stat-value inactive">444</div>
    </article>
    <article class="stat-card">
      <div class="stat-label">New (7 days)</div>
      <div class="stat-value new">127</div>
    </article>
  </section>

  <!-- MAIN TABLE -->
  <section class="table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th>Joined Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td class="user-id">#{{ user._id }}</td>
          <td>
            <div class="user-info">
              <div class="user-avatar">{{ user.username.charAt(0) }}</div>
              <span class="user-name">{{ user.username }}</span>
            </div>
          </td>
          <td class="user-email">{{ user.email }}</td>
          <td>
            <span class="role-badge">{{ user.role }}</span>
          </td>
          <td>
            <span [class]="'status-badge ' + (user.active ? 'active' : 'inactive')">
              {{ user.active ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td class="join-date">{{ user.birthday | date:'dd/MM/yyyy' }}</td>
          <td>
            <div class="action-buttons">
              <button class="action-btn view" title="View details">
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
              </button>
              
              <!-- Botón de editar -->
              <button class="action-btn edit" title="Edit" (click)="openEditModal(user)">
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
              </button>

              <!-- Botón de eliminar/deshabilitar -->
              <button class="action-btn delete" title="Delete" (click)="openDeleteModal(user)">
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>

              <!-- Botón de reactivar (solo para usuarios inactivos) -->
              <button 
                *ngIf="!user.active" 
                class="action-btn reactivate" 
                title="Reactivate" 
                (click)="reactivateUser(user)"
              >
                <svg class="action-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- TABLE FOOTER WITH PAGINATION -->
    <footer class="table-footer">
      <div class="pagination-info">
        Showing {{ pagination.skip + 1 }}-{{ pagination.skip + users.length }} of {{ pagination.total }} users
      </div>
      <div class="pagination-controls">
        <button class="pagination-btn" (click)="prevPage()" [disabled]="pagination.skip === 0">Previous</button>
        <button class="pagination-btn" (click)="nextPage()" [disabled]="!pagination.hasMore">Next</button>
      </div>
    </footer>
  </section>

   <!-- MODAL DE EDICIÓN (existente) -->
  <div *ngIf="isEditModalOpen" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Edit User</h2>
        <button class="close-button" (click)="closeEditModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <form (ngSubmit)="submitEdit()" #editForm="ngForm">
          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              [(ngModel)]="editedUserData.username"
              required
              class="form-input"
            >
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              [(ngModel)]="editedUserData.email"
              required
              class="form-input"
            >
          </div>

          <div class="form-group">
            <label for="birthday">Birthday</label>
            <input
              type="date"
              id="birthday"
              name="birthday"
              [(ngModel)]="editedUserData.birthday"
              required
              class="form-input"
            >
          </div>

          <div class="form-group">
            <label for="role">Role</label>
            <select
              id="role"
              name="role"
              [(ngModel)]="editedUserData.role"
              required
              class="form-input"
            >
              <option value="user">User</option>
              <option value="manager">Manager</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input
                type="checkbox"
                name="active"
                [(ngModel)]="editedUserData.active"
              >
              Active User
            </label>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button 
          type="submit" 
          class="btn-primary" 
          (click)="submitEdit()"
          [disabled]="loading"
        >
          {{ loading ? 'Updating...' : 'Update User' }}
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL DE ELIMINACIÓN/DESHABILITACIÓN (nuevo) -->
  <div *ngIf="isDeleteModalOpen" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h2>Manage User</h2>
        <button class="close-button" (click)="closeDeleteModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="warning-message">
          <svg class="warning-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
          <p>You are about to perform an action on user: <strong>{{ deletingUser?.username }}</strong></p>
        </div>

        <div class="action-selection">
          <div class="radio-group">
            <label class="radio-label">
              <input
                type="radio"
                name="deleteAction"
                value="disable"
                [(ngModel)]="deleteAction"
                [checked]="deleteAction === 'disable'"
              >
              <div class="radio-content">
                <span class="radio-title">Disable User</span>
                <span class="radio-description">The user will be deactivated but can be restored later. Recommended option.</span>
              </div>
            </label>

            <label class="radio-label">
              <input
                type="radio"
                name="deleteAction"
                value="delete"
                [(ngModel)]="deleteAction"
              >
              <div class="radio-content">
                <span class="radio-title">Delete Permanently</span>
                <span class="radio-description">The user will be permanently deleted from the system. This action cannot be undone.</span>
              </div>
            </label>
          </div>
        </div>

        <div *ngIf="deleteAction === 'delete'" class="danger-zone">
          <svg class="danger-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
          <p><strong>Danger Zone:</strong> This action will permanently delete the user and all associated data.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button 
          type="button" 
          class="btn-danger" 
          (click)="confirmDeleteAction()"
          [disabled]="loading"
        >
          {{ loading ? 'Processing...' : (deleteAction === 'disable' ? 'Disable User' : 'Delete Permanently') }}
        </button>
      </div>
    </div>
  </div>

  <!-- INFORMATION NOTE -->
  <aside class="info-note">
    <svg class="info-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <div class="info-text">
      This table uses example data. You can replace the data with your own database logic.
    </div>
  </aside>
</div>